# Sessions テーブル詳細設計

## ドキュメント目的
- `sessions`テーブルの構造を明文化し、Laravelセッションストアとしての運用を整理する。
- セッション管理方式の変更時は本書と設定ファイルを更新する。

## 1. 基本情報
| 項目 | 内容 | 備考 |
|---|---|---|
| テーブル物理名 | sessions |  |
| テーブル論理名 | セッション | Laravel標準 |
| ドメイン/コンテキスト | Infra（セッション） |  |
| 主キー | id（VARCHAR(255)） |  |

## 2. カラム定義
| No | カラム名 | 論理名 | 型 | PK | Not Null | デフォルト | 説明/業務ルール | 備考 |
|---|---|---|---|---|---|---|---|---|
| 1 | id | セッションID | VARCHAR(255) | ○ | ○ |  | セッショントークン。 | 主キー |
| 2 | user_id | 顧客ID | BIGINT UNSIGNED |  |  |  | ログイン顧客のID。 | `users.id`参照（FKなし） |
| 3 | ip_address | IPアドレス | VARCHAR(45) |  |  |  | IPv6対応。 |  |
| 4 | user_agent | User-Agent | TEXT |  |  |  | ブラウザ情報。 |  |
| 5 | payload | セッションデータ | LONGTEXT |  | ○ |  | シリアライズ済みデータ。 |  |
| 6 | last_activity | 最終アクティビティ | INT |  | ○ |  | UNIXタイムスタンプ（秒）。 | インデックスあり |

## 3. インデックス・キー設計
| 種別 | 名称 | 対象カラム | ユニーク | 用途/目的 | 備考 |
|---|---|---|---|---|---|
| 主キー | PRIMARY | id | ○ | セッション一意性 |  |
| セカンダリ | sessions_user_id_index | user_id | × | 顧客のセッション確認 |  |
| セカンダリ | sessions_last_activity_index | last_activity | × | 期限切れ削除ジョブ |  |

## 4. 制約・リレーション
| 種別 | 名称 | 内容 | 備考 |
|---|---|---|---|
| 業務ルール | TTL管理 | `last_activity`が一定時間経過したレコードをバッチで削除。 |  |
| 業務ルール | user_id参照 | 外部キーは未設定。整合性はアプリ層で担保。 |  |

## 改定履歴
| 改定日 | 版数 | 変更概要 | 担当 |
|---|---|---|---|
| 2025-09-19 | v0.1 | 新規作成 |  |
| 2025-10-10 | v1 | フェーズ0.5のリリース版 | Codex AI |
