# テーブル一覧

## ドキュメント目的
- 詳細設計段階で確定したテーブル仕様を集約し、設計・レビューを迅速化する。
- 各テーブルの詳細仕様は必要に応じて個別ドキュメントへ分割し、整合性を保つ。

## 記載ルール
| 項目 | ルール | 備考 |
|---|---|---|
| テーブル名 | スネークケース、小文字。 | 例: `users`, `operators` |
| 主キー | 複合キーは列順を明記。 | 例: `id`, `tenant_id + user_id` |
| 主要カラム | 業務的に重要なカラムを列挙（3〜6項目）。 | 例: `email`, `status` |
| インデックス | ユニーク/通常、複合キーを明記。 | 例: `email (UNIQUE)` |
| リレーション | 参照元/先を `テーブル.col ⇔ テーブル.col` で表記。 | FKが無い場合は `-` |
| 詳細設計 | 対応ドキュメントが未整備の場合は `-`。 | 例: `[Users](./01_Users.md)` |

## テーブル一覧

### 認証・セッション
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| operators | 運営者アカウント情報 | id | email, password, role, deleted_at | email (UNIQUE) | operators.id ⇔ company_operators.operator_id / task_managers.manager_id / task_logs.operator_id | - | 姓名・パスワードはnullable |
| users | 企業担当者アカウント | id | company_id, email, password, last_name, deleted_at | email (UNIQUE) | companies.id ⇔ users.company_id / users.id ⇔ application_requests.user_id・notification_companies.read_user_id・labor_document_edits.edited_by | - | パスワードはnullable |
| create_operator_tokens | 運営者招待メール用トークン | email | token, created_at | email (PRIMARY) | - | - | メールアドレスをキーとした一時トークン |
| password_reset_tokens | パスワード再発行トークン | email | token, created_at | email (PRIMARY) | - | - | - |
| sessions | Laravelセッション | id | user_id, last_activity, ip_address | id (PRIMARY), user_id, last_activity | users.id ⇔ sessions.user_id | - | - |

### マスタ
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| prefectures | 都道府県マスタ | id | name | - | prefectures.id ⇔ companies.prefecture_id / municipalities.prefecture_id | - | - |
| municipalities | 市区町村マスタ | id | prefecture_id, name, code, kana | prefecture_id + name | prefectures.id ⇔ municipalities.prefecture_id | - | 市区町村コード・カナは任意 |
| industries | 業種マスタ | id | industry_name, deleted_at | - | industries.id ⇔ company_industries.industry_id | - | 論理削除対応 |
| labels | ラベルマスタ | id | label_content, deleted_at | - | labels.id ⇔ company_labels.label_id | - | 論理削除対応 |

### 企業管理
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| companies | 企業基本情報 | id | company_name, email, prefecture_id, postal_code, employee_count | prefecture_id | prefectures.id ⇔ companies.prefecture_id / companies.id ⇔ users.company_id・company_operators.company_id・company_labels.company_id・company_industries.company_id・company_logs.company_id・employment_regulations.company_id | - | 住所系は必須・論理削除あり |
| company_operators | 企業と運営者の紐づけ | id | company_id, operator_id, status, deleted_at | company_id, operator_id | companies.id ⇔ company_operators.company_id / operators.id ⇔ company_operators.operator_id | - | ステータスは可変文字列 |
| company_labels | 企業とラベルの紐づけ | id | company_id, label_id, deleted_at | company_id, label_id | companies.id ⇔ company_labels.company_id / labels.id ⇔ company_labels.label_id | - | - |
| company_industries | 企業と業種の紐づけ | id | company_id, industry_id, deleted_at | company_id, industry_id | companies.id ⇔ company_industries.company_id / industries.id ⇔ company_industries.industry_id | - | - |
| company_logs | 企業対応ログ | id | company_id, operator_id, content, deleted_at | - | companies.id ⇔ company_logs.company_id / operators.id ⇔ company_logs.operator_id | - | 運営者外部キーは未設定 |

### 通知
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| notifications | お知らせ本文 | id | title, content, deleted_at | - | notifications.id ⇔ notification_files.notification_id・notification_companies.notification_id | - | 論理削除はtimestamp |
| notification_files | お知らせ添付ファイル | id | notification_id, name, url, deleted_at | notification_id, name, url | notifications.id ⇔ notification_files.notification_id | - | URL文字列保持 |
| notification_companies | お知らせ配信先・既読 | id | notification_id, company_id, read_time, read_user_id | notification_id + company_id (UNIQUE), read_time | notifications.id ⇔ notification_companies.notification_id / companies.id ⇔ notification_companies.company_id / users.id ⇔ notification_companies.read_user_id | - | 未読時はread_time/read_user_id null |

### チャット
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| chat_rooms | チャットルーム | id | company_id, name, deleted_at | company_id, created_at, deleted_at | companies.id ⇔ chat_rooms.company_id | - | - |
| chat_room_participants | ルーム参加者 | id | chat_room_id, participant_id, participant_type, role, deleted_at | chat_room_id, participant_id + participant_type (UNIQUE), role | chat_rooms.id ⇔ chat_room_participants.chat_room_id | - | ポリモーフィック参照 |
| chat_messages | チャットメッセージ | id | chat_room_id, sender_id, sender_type, content, deleted_at | chat_room_id + created_at, sender_id + sender_type, FULLTEXT content | chat_rooms.id ⇔ chat_messages.chat_room_id | - | 本文はnullable |
| chat_message_files | メッセージ添付ファイル | id | chat_message_id, file_name, file_path, s3_key, access_token, expires_at | chat_message_id, s3_key, access_token + expires_at | chat_messages.id ⇔ chat_message_files.chat_message_id | - | file_pathはnullable、セキュア配信フィールド有 |
| chat_message_reads | 既読管理 | id | chat_message_id, user_id, user_type, read_at | chat_message_id + user_id + user_type (UNIQUE), user_id + user_type + read_at | chat_messages.id ⇔ chat_message_reads.chat_message_id | - | 既読時刻を保持 |
| chat_message_mentions | メンション管理 | id | message_id, mentioned_user_id, mentioned_user_type, start_position | message_id + mentioned_user_id + mentioned_user_type + start_position (UNIQUE) | chat_messages.id ⇔ chat_message_mentions.message_id | - | 開始・終了位置で本文範囲を特定 |

### タスク管理
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| tasks | タスク共通 | id | company_id, category, name, status, limit_date, taskable_id/type, deleted_at | company_id, category, status, limit_date, taskable_id + taskable_type | companies.id ⇔ tasks.company_id / tasks.id ⇔ task_managers.task_id・task_logs.task_id | - | nameは500文字まで拡張 |
| task_managers | タスク担当者 | id | task_id, manager_id, status, deleted_at | task_id, manager_id, task_id + status | tasks.id ⇔ task_managers.task_id / operators.id ⇔ task_managers.manager_id | - | statusで主/副担当を管理 |
| task_logs | タスク履歴 | id | task_id, operator_id, content, deleted_at | task_id, operator_id, created_at | tasks.id ⇔ task_logs.task_id / operators.id ⇔ task_logs.operator_id | - | - |

### 助成金・申請
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| fundings | 助成金・補助金情報 | id | external_funding_id, name, field, target, industry, recruitment_period, support_content, is_priority_display, deleted_at | name, field, area, organization, type, target, industry, support_scale, deadline_period, public_end_date, last_updated, is_priority_display, external_funding_id (UNIQUE), type + area, field + industry | fundings.id ⇔ funding_files.funding_id・application_requests.funding_id | - | external_funding_idは必須一意／sagaseru_idは廃止済 |
| funding_files | 助成金関連ファイル | id | funding_id, file_name, file_path, category, is_public, deleted_at | funding_id, category, is_public, sort_order | fundings.id ⇔ funding_files.funding_id | - | ソート順・公開制御あり |
| social_insurance_firms | 社労士法人マスタ | id | name, base_fee, success_fee_rate, is_active | name, is_active | social_insurance_firms.id ⇔ application_requests.firm_id | - | 金額はdecimal、URL保持 |
| application_requests | 助成金申請依頼 | id | user_id, company_id, funding_id, firm_id, request_date | user_id, company_id, funding_id, firm_id, request_date | users.id ⇔ application_requests.user_id / companies.id ⇔ application_requests.company_id / fundings.id ⇔ application_requests.funding_id / social_insurance_firms.id ⇔ application_requests.firm_id | - | ステータス列は削除済み（進捗は別管理） |

### 労務・就業規則
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| employment_regulations | 企業別就業規則入力値 | id | company_id, registration_status, salary体系各種, total_break_minutes, has_fixed_overtime_allowance, has_half_day_paid_leave, has_hourly_paid_leave, has_mutual_aid_retirement_allowance, has_summer_bonus, has_winter_bonus, has_reemployment, reemployment_age | company_id (UNIQUE) | companies.id ⇔ employment_regulations.company_id / employment_regulations.id ⇔ labor_documents.employment_regulation_id・break_times.employment_regulation_id | - | CHECK制約を多数保持／旧休憩時間列はbreak_timesへ移行済 |
| break_times | 休憩時間定義（複数） | id | employment_regulation_id, break_start_hour/minute, break_end_hour/minute, display_order | employment_regulation_id, employment_regulation_id + display_order | employment_regulations.id ⇔ break_times.employment_regulation_id | - | 休憩時間を明細で管理 |
| labor_documents | 労務ドキュメント生成履歴 | id | company_id, employment_regulation_id, document_type, template_code, template_name, file_name, s3_key, mime_type, file_size, generated_at, created_by_type/id, deleted_at | company_id + document_type, employment_regulation_id, template_code, created_by_type + created_by_id | companies.id ⇔ labor_documents.company_id / employment_regulations.id ⇔ labor_documents.employment_regulation_id | - | ステータス列は撤廃／S3関連カラムはnullable |
| labor_document_edits | 労務ドキュメント編集履歴 | id | original_document_id, edited_document_id, edited_by | original_document_id, edited_document_id, edited_by, created_at | labor_documents.id ⇔ labor_document_edits.original_document_id・labor_document_edits.edited_document_id / users.id ⇔ labor_document_edits.edited_by | - | 編集差分の追跡用 |

### システム共通
| テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|
| cache | キャッシュストア | key | value, expiration | key (PRIMARY) | - | - | - |
| cache_locks | キャッシュロック | key | owner, expiration | key (PRIMARY) | - | - | - |

## 改定履歴
| 改定日 | 版数 | 変更概要 | 担当 |
|---|---|---|---|
| 2025-10-08 | v0.2 | マイグレーション反映版として全テーブル情報を整理 | Codex |
